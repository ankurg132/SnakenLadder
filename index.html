<!DOCTYPE html>
<html>

<head>
   <style>
      * {
         margin: 0;
         padding: 0;
         box-sizing: border-box;
      }

      #canvasdiv {
         display: flex;
         justify-content: center;
         align-items: center;
         flex-direction: column;
         height: 97vh;
         position: relative;

      }

      #startingZone {
         width: 500px;
         position: relative;
      }

      #test {
         width: 500px;
         position: relative;
      }

      #test img {
         position: absolute;
         top: 0px;
         transition: 1s ease;
      }

      #startingZone img {
         position: absolute;
         top: 500px;
         transition: 1s ease;
      }

      #startingZone img:nth-child(1) {
         left: 0px;
      }

      #startingZone img:nth-child(2) {
         left: 20px;
      }

      #startingZone img:nth-child(3) {
         left: 40px;
      }

      #startingZone img:nth-child(4) {
         left: 60px;
      }

      .hidden {
         display: none;
         /* opacity: 0; */
      }

      #screen {
         display: flex;
         justify-content: center;
         align-items: center;
         position: fixed;
         top: 0;
         left: 0;
         width: 100vw;
         height: 100%;
         color: black;
         background: #ffff88;
      }

      .playerbox {
         position: fixed;
         height: 200px;
         width: 200px;
         display: flex;
         justify-content: center;
         align-items: center;
         flex-direction: column;
      }

      .playerbox span {
         font-size: 1.6em;
      }

      .playerbox button,
      .playerbox button img {
         border: none;
         border-radius: 20px;
         outline: none;
         transition: top 0.5s ease;
      }

      .playerbox .activebutton:hover {
         position: relative;
         top: -2px;

         box-shadow: 0px 5px 4px black;
         cursor: pointer;
      }

      .topleft {
         top: 0;
         left: 0;
      }

      .bottomleft {
         bottom: 0;
         left: 0;
      }

      .topright {
         top: 0;
         right: 0;
      }

      .bottomright {
         bottom: 0;
         right: 0;
      }

      .disabled {
         background: grey !important;
         color: white;
      }
   </style>
   <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>

<body>

   <div id="canvasdiv">
      <div id="winnerZone"></div>
      <div id="test">
         <img src="img/snake01.png" class="hidden" id="snake1" data-down="4" data-left="0" data-side="1" data-bottom="4"
            data-right="2" width="130px" data-headx="0">
         <img src="img/snake03.png" class="hidden" id="snake2" data-down="3" data-left="0" data-side="2" data-bottom="3"
            data-right="2" width="115px" data-headx="0">
         <img src="img/snake04.png" class="hidden" id="snake3" data-down="3" data-left="0" data-side="1" data-bottom="3"
            data-right="2" width="115px" data-headx="0">
         <img src="img/snake05.png" class="hidden" id="snake4" data-down="2" data-left="0" data-side="0" data-bottom="2"
            data-right="2" width="135px" data-headx="0">
         <img src="img/snake06.png" class="hidden" id="snake5" data-down="2" data-left="0" data-side="0" data-bottom="2"
            data-right="2" width="135px" data-headx="0">
         <img src="img/snake07.png" class="hidden" id="snake6" data-down="4" data-left="0" data-side="0" data-bottom="4"
            data-right="0" width="45px" data-headx="0">
         <img src="img/snake01.png" class="hidden" id="snake7" data-down="4" data-left="0" data-side="2" data-bottom="4"
            data-right="2" width="130px" data-headx="0">
         <img src="img/snake03.png" class="hidden" id="snake8" data-down="3" data-left="0" data-side="2" data-bottom="3"
            data-right="2" width="115px" data-headx="0">


         <!-- <img src="img/snake02.png" class="hidden" id="snake2" data-down="5" data-left="2" data-side="-2" data-bottom="5" data-right="0" width="115px" data-headx="2"> -->
         <!-- <img src="img/snake08.png" class="hidden" id="snake8" data-down="5" data-left="2" data-side="-2" data-bottom="5" data-right="0" width="115px" data-headx="2"> -->


         <img src="img/ladder01.png" id="ladder1" class="hidden" data-down="3" data-side="-1" data-left="1"
            data-right="0" width="100px" data-headx="1">
         <img src="img/ladder02.png" id="ladder2" class="hidden" data-down="3" data-side="0" data-left="0"
            data-right="0" width="35px" data-headx="0">
         <img src="img/ladder03.png" id="ladder3" class="hidden" data-down="2" data-side="1" data-left="0"
            data-right="2" width="100px" data-headx="0">
         <img src="img/ladder04.png" id="ladder4" class="hidden" data-down="1" data-side="-1" data-left="1"
            data-right="0" width="69px" data-headx="1">
         <img src="img/ladder05.png" id="ladder5" class="hidden" data-down="4" data-side="0" data-left="0"
            data-right="0" width="50px" data-headx="0">
         <img src="img/ladder06.png" id="ladder6" class="hidden" data-down="2" data-side="-1" data-left="2"
            data-right="0" width="70px" data-headx="1">
         <img src="img/ladder07.png" id="ladder7" class="hidden" data-down="2" data-side="0" data-left="0"
            data-right="0" width="35px" data-headx="0">
         <img src="img/ladder08.png" id="ladder8" class="hidden" data-down="1" data-side="0" data-left="0"
            data-right="0" width="30px" data-headx="0">
         <img src="img/ladder09.png" id="ladder9" class="hidden" data-down="2" data-side="-1" data-left="1"
            data-right="0" width="100px" data-headx="1">
         <img src="img/ladder10.png" id="ladder10" class="hidden" data-down="3" data-side="1" data-left="0"
            data-right="1" width="100px" data-headx="0">

      </div>
      <div id="startingZone">
         <!-- <img src="img/player1.png" alt="Red Player" width="50px">
         <img src="img/player2.png" alt="Red Player" width="50px">
         <img src="img/player3.png" alt="Red Player" width="50px">
         <img src="img/player4.png" alt="Red Player" width="50px"> -->
      </div>
      <canvas id="myCanvas" width="500" height="500" style="border:1px solid #c3c3c3;">
         Your browser does not support the canvas element.
      </canvas>




   </div>


   <!-- <div class=" playerbox topleft disabled">
      <span>Player 1</span>
      <button id="add" name="text" class="input button"><img id="gifbox" src="img/dice/rolldice.jpg"
            width="100px"></button>
   </div>
   <div class="playerbox w3-green bottomleft">
      <span>Player 1</span>
      <button id="add" name="text" class="input button"><img id="gifbox" src="img/dice/rolldice.jpg"
            width="100px"></button>
   </div>
   <div class="playerbox w3-blue bottomright">
      <span>Player 1</span>
      <button id="add" name="text" class="input button"><img id="gifbox" src="img/dice/rolldice.jpg"
            width="100px"></button>
   </div>
   <div class="playerbox w3-yellow topright">
      <span>Player 1</span>
      <button id="add" name="text" class="input button"><img id="gifbox" src="img/dice/rolldice.jpg"
            width="100px"></button>
   </div> -->

   <!-- <//screen> -->
   <div id="screen" class="">
      <div id="box">
         <img src="img/snl.png" alt="" width="400px">
         <center>
            <h2>Select no. of Players</h2>

            <select id="noofplayer" class="w3-select" name="option">
               <option value="0" disabled selected>Choose your option</option>
               <option value="1">1 Player</option>
               <option value="2">2 Players</option>
               <option value="3">3 Players</option>
               <option value="4">4 Players</option>

            </select>
            <br><br><button onclick="updatePlayer()" class="w3-button w3-blue w3-round-xlarge">Start Game</button>
         </center>
      </div>
   </div>

   <script>

      var canvas = document.getElementById("myCanvas");
      var ctx = canvas.getContext("2d");

      var boardSize = 500;
      var boardColumn = 10;
      var boxSize = boardSize / boardColumn;
      var oddBackground = "#2ab7ca";
      var evenBackground = "#fed766";
      var oddText = "#fff";
      var evenText = "#000";
      var noOfSnakes = rand(1, 8);
      var noOfLadder = rand(1, 10);
      // var noOfSnakes = 8;
      // var noOfLadder = 10;
      var snakeHead = [];
      var snakeTail = [];
      var ladderHead = [];
      var ladderTail = [];
      var noOfPlayer = 0;
      var positions = [["topleft"],
      ["topleft", "bottomright"],
      ["topleft", "bottomleft", "bottomright"],
      ["topleft", "bottomleft", "bottomright", "topright"]]
      var colors = ["red", "green", "blue", "yellow"];
      var playersPos = []


      function updatePlayer() {
         if ($('#noofplayer').val() != null) {
            $('#screen').hide();
            noOfPlayer = $('#noofplayer').val();

            startGame();
         } else {
            alert("Please Select No. of Players");
         }
      }
      // startGame();

      function giveChanceTo(playerNum) {
         
         if(playerNum>noOfPlayer){
            playerNum = 1;
         }
         
         for (let i = 1; i <= noOfPlayer; i++) {
            $("#playerbox" + i).removeClass("w3-" + colors[i - 1]);
            $("#playerbox" + i +" button").removeClass("activebutton");
            $("#playerbox"+i+" button").prop('disabled', true);
            $("#playerbox" + i).addClass("disabled");
         }
         
         $("#playerbox"+playerNum).addClass("w3-" + colors[playerNum - 1]);
         $("#playerbox" + playerNum+ " button").addClass("activebutton");
         $("#playerbox" + playerNum + " button").prop('disabled', false);
         $("#playerbox"+playerNum).removeClass("disabled");

      }

      function doChance(playerNum) {
         $("#playerbox" + playerNum + " button").prop("disabled", true);
         var val = rand(1,6);
         var path = "img/dice/"+val + ".jpg"



         var now = new Date().getTime();
         $("#playerbox" + playerNum + " button img").attr("src", "img/dice/roll.gif")
         
         setTimeout(harsh, 2000,)
         
         function harsh() {
            console.log(val);
            
            $("#playerbox" + playerNum + " button img").attr("src", path)
            playersPos[playerNum - 1] +=val;
            movePlayer(playerNum, playersPos[playerNum - 1]);
            giveChanceTo(playerNum + 1);
         }

      }
      function sleepFor(sleepDuration) {
            var now = new Date().getTime();
            while (new Date().getTime() < now + sleepDuration) { /* do nothing */ }
         }

      //Initialiing the Game
      function startGame() {
         makeBoard();

         //Plotting Players
         for (let i = 1; i <= noOfPlayer; i++) {
            $("#startingZone").append('<img src="img/player' + i + '.png" id="player' + i + '" width="' + (0.8) * boxSize + 'px">');
            $("body").append('<div id="playerbox'+i+'" class="playerbox w3-' + colors[i - 1] + ' ' + positions[noOfPlayer - 1][i - 1] + '"> <span> Player ' + i + '</span><button onclick="doChance('+i+')" id="add" name="text" class="input button"><img id="gifbox" src="img/dice/rolldice.jpg" width="100px"></button></div>');
            playersPos.push(0);
         }
         giveChanceTo(1);
      }






      //Making Board
      function makeBoard() {
         var n = boardColumn * boardColumn;

         //MAking Actual Board
         for (let i = 1; i <= boardColumn; i++) {
            for (let j = 1; j <= boardColumn; j++) {

               if ((i % 2 == 0 && j % 2 == 1) || (i % 2 == 1 && j % 2 == 0)) {
                  ctx.fillStyle = evenBackground;
               } else {
                  ctx.fillStyle = oddBackground;
               }
               ctx.fillRect(boxSize * j - boxSize, boxSize * i - boxSize, (boxSize * j), boxSize * i);


               if ((i % 2 == 0 && j % 2 == 1) || (i % 2 == 1 && j % 2 == 0)) {

                  ctx.fillStyle = evenText;
               } else {
                  ctx.fillStyle = oddText;
               }
               if (i % 2 == 0) {
                  var number = n + j - boardColumn;
               } else {
                  var number = n - j + 1;
               }
               ctx.fillText(number, (boxSize * j) - boxSize + 10, (boxSize * i) - boxSize + 15);

            }
            n -= boardColumn;


         }


         //Plotting Snakes
         for (var i = 1; i <= noOfSnakes; i++) {
            var pos = getSnakePos(i);

            renderSnake(i, pos);
            snakeHead.push(pos);
            snakeTail.push(getSnakeTail(i, pos));
            function getSnakePos(snakeNum) {

               var pos = rand(31, 99);
               var snakeRight = Number($("#snake" + snakeNum).attr("data-right"));
               var snakeBottom = Number($("#snake" + snakeNum).attr("data-bottom"));


               //Shifting from Bottom and Left
               var bottom = Math.ceil(pos / 10) - 1;
               if (snakeBottom >= bottom) { pos += 10; }

               //for left to right
               if (Math.ceil(pos / 10) % 2 != 0) {
                  var right = 10 - (pos - ((Math.ceil(pos / 10) - 1) * 10));
                  if (snakeRight >= right) { pos -= snakeRight; }
                  // console.log("pos = " + pos + " right=" + right + " snakeRight=" + snakeRight);

               }
               //for right to left
               else {
                  var right = (pos % 10) - 1;
                  if (snakeRight >= right) { pos += snakeRight; }
               }

               if (snakeHead.includes(pos)) {
                  return getSnakePos(snakeNum);
               } else if (snakeTail.includes(pos)) {
                  return getSnakePos(snakeNum);
               } else if (snakeHead.includes(getSnakeTail(snakeNum, pos))) {
                  return getSnakePos(snakeNum);
               } else if (snakeTail.includes(getSnakeTail(snakeNum, pos))) {
                  return getSnakePos(snakeNum);
               }
               else {
                  return pos;
               }
               // console.log("pos = " + pos + " right=" + right + " snakeRight=" + snakeRight);

            }

            function getSnakeTail(snakeNum, pos) {
               var bottom = 0;
               var snakeRight = Number($("#snake" + snakeNum).attr("data-right"));
               var snakeSide = Number($("#snake" + snakeNum).attr("data-side"));
               var snakeDown = Number($("#snake" + snakeNum).attr("data-bottom"));
               if (snakeDown % 2 == 0) {
                  //for left to right
                  if (Math.ceil(pos / 10) % 2 != 0) {
                     bottom = pos - (snakeDown * 10) + snakeSide;
                  }
                  //for right to left
                  else {
                     bottom = pos - (snakeDown * 10) - snakeSide;
                  }
               } else {
                  //for left to right
                  if (Math.ceil(pos / 10) % 2 != 0) {
                     var left = pos - ((Math.ceil(pos / 10) - 1) * 10) - 1;
                     bottom = pos - ((snakeDown - 1) * 10) - snakeSide - (2 * left) - 1;
                  }
                  //for right to left
                  else {
                     var right = pos - ((Math.ceil(pos / 10) - 1) * 10) - 1;
                     bottom = pos - ((snakeDown - 1) * 10) + snakeSide - (2 * right) - 1;
                     // console.log("right :" + right + " pos :" + pos + " bottom :" + bottom);
                  }
               }
               return bottom;
            }
         }


         //Plotting Ladder
         for (var i = 1; i <= noOfLadder; i++) {
            var pos = getLadderPos(i);

            renderLadder(i, pos);
            ladderHead.push(pos);
            ladderTail.push(getLadderTail(i, pos));
            function getLadderPos(ladderNum) {

               var pos = rand(31, 99);
               var ladderRight = Number($("#ladder" + ladderNum).attr("data-right"));
               var ladderLeft = Number($("#ladder" + ladderNum).attr("data-left"));
               var ladderBottom = Number($("#ladder" + ladderNum).attr("data-down"));


               //Shifting from Bottom and Left
               var bottom = Math.ceil(pos / 10) - 1;
               if (ladderBottom >= bottom) { pos += 10; }

               //for left to right
               if (Math.ceil(pos / 10) % 2 != 0) {
                  var right = 10 - (pos - ((Math.ceil(pos / 10) - 1) * 10));
                  if (ladderRight >= right) { pos -= ladderRight; }
                  var left = pos - ((Math.ceil(pos / 10) - 1) * 10) - 1;

                  console.log("pos = " + pos + " left=" + left + " ladderRight=" + ladderRight);
                  if (ladderLeft >= left) { pos += ladderLeft; }

               }
               //for right to left
               else {
                  var right = (pos % 10) - 1;
                  if (ladderRight >= right) { pos += ladderRight; }
                  var left = 10 - (pos - ((Math.ceil(pos / 10) - 1) * 10));
                  if (ladderLeft >= left) { pos += ladderLeft; }
               }

               if (ladderHead.includes(pos)) {
                  return getLadderPos(ladderNum);
               } else if (ladderTail.includes(pos)) {
                  return getLadderPos(ladderNum);
               } else if (ladderHead.includes(getLadderTail(ladderNum, pos))) {
                  return getLadderPos(ladderNum);
               } else if (ladderTail.includes(getLadderTail(ladderNum, pos))) {
                  return getLadderPos(ladderNum);
               } else if (snakeHead.includes(pos)) {
                  return getLadderPos(ladderNum);
               } else if (snakeTail.includes(pos)) {
                  return getLadderPos(ladderNum);
               } else if (snakeHead.includes(getLadderTail(ladderNum, pos))) {
                  return getLadderPos(ladderNum);
               } else if (snakeTail.includes(getLadderTail(ladderNum, pos))) {
                  return getLadderPos(ladderNum);
               }
               else {
                  return pos;
               }
               // console.log("pos = " + pos + " right=" + right + " snakeRight=" + snakeRight);

            }

            function getLadderTail(ladderNum, pos) {
               var bottom = 0;
               var ladderRight = Number($("#ladder" + ladderNum).attr("data-right"));
               var ladderSide = Number($("#ladder" + ladderNum).attr("data-side"));
               var ladderDown = Number($("#ladder" + ladderNum).attr("data-down"));
               if (ladderDown % 2 == 0) {
                  //for left to right
                  if (Math.ceil(pos / 10) % 2 != 0) {
                     bottom = pos - (ladderDown * 10) + ladderSide;
                  }
                  //for right to left
                  else {
                     bottom = pos - (ladderDown * 10) - ladderSide;
                  }
               } else {
                  //for left to right
                  if (Math.ceil(pos / 10) % 2 != 0) {
                     var left = pos - ((Math.ceil(pos / 10) - 1) * 10) - 1;
                     bottom = pos - ((ladderDown - 1) * 10) - ladderSide - (2 * left) - 1;
                  }
                  //for right to left
                  else {
                     var right = pos - ((Math.ceil(pos / 10) - 1) * 10) - 1;
                     bottom = pos - ((ladderDown - 1) * 10) + ladderSide - (2 * right) - 1;
                     // console.log("right :" + right + " pos :" + pos + " bottom :" + bottom);
                  }
               }
               return bottom;
            }
         }



      }

      //Functions for Calculating X and Y
      function calcY(pos) {
         var a = boardColumn * boardColumn - pos;
         var y = Math.floor(a / 10) * boxSize;
         // console.log("A= "+a);
         // console.log("y= " + y); 
         return y;
      }
      function calcX(pos) {
         var a = boardColumn * boardColumn - pos;
         var y = Math.floor(a / 10);
         var x = a - y * boardColumn;

         if (y % 2 == 1) {
            x = boardColumn - x - 1;
         } else {
            x = x;
         }
         // console.log("A= "+a);
         // console.log("y= " + y); 
         // console.log("x= " + x); 
         return x * boxSize;
      }

      //Render Snakes
      function renderSnake(snakeNum, pos) {
         // var img = document.getElementById("snake" + snakeNum);
         // console.log($("#snake" + snakeNum).attr("data-headx"));
         var y = Math.floor((boardColumn * boardColumn - pos) / 10);
         // var shift = 0;
         // if (y % 2 != 0) {
         //    shift = Number($("#snake" + snakeNum).attr("data-headx"));
         // } else {
         //    shift = -Number($("#snake" + snakeNum).attr("data-headx"));
         // }

         // console.log("pos = " + pos + "shiftt=" + shift);
         $("#snake" + snakeNum).css({ "display": "block", "top": calcY(pos), "left": calcX(pos) });
      }

      //Render Ladder
      function renderLadder(ladderNum, pos) {
         // var img = document.getElementById("snake" + snakeNum);
         // console.log($("#snake" + snakeNum).attr("data-headx"));
         var y = Math.floor((boardColumn * boardColumn - pos) / 10);
         var shift = 0;
         if (y % 2 != 0) {
            shift = Number($("#ladder" + ladderNum).attr("data-headx"));
         } else {
            shift = -Number($("#ladder" + ladderNum).attr("data-headx"));
         }

         // console.log("pos = " + pos + "shiftt=" + shift);
         $("#ladder" + ladderNum).css({ "display": "block", "top": calcY(pos) + 5, "left": calcX(pos - shift) + 5 });
      }

      //Plotting Snakes
      function plotSnake(snakeNum, pos) {
         var img = document.getElementById("snake" + snakeNum);
         console.log($("#snake" + snakeNum).attr("data-headx"));
         var y = Math.floor((boardColumn * boardColumn - pos) / 10);
         var shift = 0;
         if (y % 2 != 0) {
            shift = Number($("#snake" + snakeNum).attr("data-headx"));
         } else {
            shift = -Number($("#snake" + snakeNum).attr("data-headx"));
         }

         ctx.drawImage(img, calcX(pos - shift), calcY(pos), $("#snake" + snakeNum).width(), $("#snake" + snakeNum).height());
      }

      // Useful Functions - rand, movePlayer, makePoint

      function rand(min, max) { return Math.floor(Math.random() * (max - min)) + min; }
      function movePlayer(player, pos) { $("#player" + player).css({ top: calcY(pos), left: calcX(pos) }); }
      function makePoint(pos) { ctx.beginPath(); ctx.arc(calcX(pos) + (boxSize / 2), calcY(pos) + (boxSize / 2), 4, 0, 2 * Math.PI); ctx.stroke(); }



   </script>

</body>

</html>